<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Virtual Joystick Demo</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        color: white;
        min-height: 100vh;
        padding: 20px;
        padding-bottom: 100px;
      }

      h1 {
        text-align: center;
        margin-bottom: 10px;
        font-size: 1.5rem;
      }

      .subtitle {
        text-align: center;
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 20px;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .demo-card {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
      }

      .demo-card h2 {
        font-size: 1rem;
        margin-bottom: 5px;
        color: #4a90d9;
      }

      .demo-card .description {
        font-size: 0.8rem;
        color: #888;
        margin-bottom: 10px;
      }

      .demo-area {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 150px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        margin-bottom: 10px;
        position: relative;
      }

      /* Touch area for dynamic/semi modes */
      .touch-area {
        position: absolute;
        inset: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        color: rgba(255, 255, 255, 0.3);
        font-size: 0.8rem;
      }

      .output {
        font-family: monospace;
        font-size: 0.75rem;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 4px;
        min-height: 50px;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .buttons-row {
        display: flex;
        gap: 20px;
        justify-content: center;
      }

      /* Dynamic/semi joystick host needs to fill area */
      .demo-area virtual-joystick[mode="dynamic"],
      .demo-area virtual-joystick[mode="semi"] {
        position: absolute;
        inset: 0;
      }
    </style>
  </head>
  <body>
    <h1>Virtual Joystick Demo</h1>
    <p class="subtitle">Touch controls for mobile games - Web Components</p>

    <div class="demo-grid">
      <!-- Static Joystick - Modern -->
      <div class="demo-card">
        <h2>Static Mode (Modern)</h2>
        <p class="description">Fixed position, always visible</p>
        <div class="demo-area">
          <virtual-joystick
            id="joystick-static"
            mode="static"
            theme="modern"
            size="120"
          ></virtual-joystick>
        </div>
        <div class="output" id="output-static">Touch the joystick...</div>
      </div>

      <!-- Dynamic Mode -->
      <div class="demo-card">
        <h2>Dynamic Mode</h2>
        <p class="description">Appears where you touch</p>
        <div class="demo-area">
          <div class="touch-area">Touch anywhere in this area</div>
          <virtual-joystick
            id="joystick-dynamic"
            mode="dynamic"
            size="100"
          ></virtual-joystick>
        </div>
        <div class="output" id="output-dynamic">Touch to create joystick...</div>
      </div>

      <!-- Semi Mode -->
      <div class="demo-card">
        <h2>Semi Mode</h2>
        <p class="description">Catch within 50px or create new</p>
        <div class="demo-area">
          <div class="touch-area">Touch to create, touch near to catch</div>
          <virtual-joystick
            id="joystick-semi"
            mode="semi"
            catch-distance="50"
            size="100"
          ></virtual-joystick>
        </div>
        <div class="output" id="output-semi">Touch to initialize...</div>
      </div>

      <!-- Locked Axes -->
      <div class="demo-card">
        <h2>Locked Y-Axis</h2>
        <p class="description">Horizontal movement only</p>
        <div class="demo-area">
          <virtual-joystick
            id="joystick-lockY"
            mode="static"
            lock-y
            size="120"
          ></virtual-joystick>
        </div>
        <div class="output" id="output-lockY">Horizontal only...</div>
      </div>

      <!-- Square Shape -->
      <div class="demo-card">
        <h2>Square Shape</h2>
        <p class="description">Square boundary clamping</p>
        <div class="demo-area">
          <virtual-joystick
            id="joystick-square"
            mode="static"
            shape="square"
            size="120"
          ></virtual-joystick>
        </div>
        <div class="output" id="output-square">Square clamping...</div>
      </div>

      <!-- Action Button -->
      <div class="demo-card">
        <h2>Action Buttons</h2>
        <p class="description">Simple press and release</p>
        <div class="demo-area">
          <div class="buttons-row">
            <virtual-action-button
              id="action-btn"
              size="70"
            ></virtual-action-button>
          </div>
        </div>
        <div class="output" id="output-action">Press a button...</div>
      </div>

    </div>

    <script type="module">
      import { registerAll } from '../src/index.ts';

      // Register all components
      registerAll();

      // Helper to format position
      const fmtPos = (p) => `(${p.x.toFixed(2)}, ${p.y.toFixed(2)})`;

      // Static joystick
      const staticOut = document.getElementById('output-static');
      document.getElementById('joystick-static').addEventListener('joystick-move', (e) => {
        const d = e.detail;
        staticOut.textContent = `pos: ${fmtPos(d.position)}
force: ${d.force.toFixed(2)}
dir: ${d.direction.angle}`;
      });

      // Dynamic joystick
      const dynamicOut = document.getElementById('output-dynamic');
      const dynamicJoy = document.getElementById('joystick-dynamic');
      dynamicJoy.addEventListener('joystick-start', () => {
        dynamicOut.textContent = 'Joystick created!';
      });
      dynamicJoy.addEventListener('joystick-move', (e) => {
        const d = e.detail;
        dynamicOut.textContent = `pos: ${fmtPos(d.position)}
force: ${d.force.toFixed(2)}`;
      });
      dynamicJoy.addEventListener('joystick-end', () => {
        dynamicOut.textContent = 'Joystick released';
      });

      // Semi joystick
      const semiOut = document.getElementById('output-semi');
      const semiJoy = document.getElementById('joystick-semi');
      semiJoy.addEventListener('joystick-start', () => {
        semiOut.textContent = 'Touch started!';
      });
      semiJoy.addEventListener('joystick-move', (e) => {
        const d = e.detail;
        semiOut.textContent = `pos: ${fmtPos(d.position)}
force: ${d.force.toFixed(2)}`;
      });
      semiJoy.addEventListener('joystick-end', () => {
        semiOut.textContent = 'Released (position saved)';
      });

      // Locked Y events
      const lockYOut = document.getElementById('output-lockY');
      document.getElementById('joystick-lockY').addEventListener('joystick-move', (e) => {
        const d = e.detail;
        lockYOut.textContent = `x: ${d.position.x.toFixed(2)}
y: ${d.position.y.toFixed(2)} (locked)
dir: ${d.direction.x}`;
      });

      // Square shape
      const squareOut = document.getElementById('output-square');
      document.getElementById('joystick-square').addEventListener('joystick-move', (e) => {
        const d = e.detail;
        squareOut.textContent = `pos: ${fmtPos(d.position)}
raw: ${fmtPos(d.rawPosition)}`;
      });

      // Action button events
      const actionOut = document.getElementById('output-action');
      const actionBtn = document.getElementById('action-btn');
      actionBtn.addEventListener('button-press', () => {
        actionOut.textContent = 'PRESSED';
      });
      actionBtn.addEventListener('button-release', (e) => {
        actionOut.textContent = `Released\nduration: ${e.detail.duration.toFixed(0)}ms`;
      });

    </script>
  </body>
</html>
